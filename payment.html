<!DOCTYPE html>
<html lang="th">

<head>
<script>document.write('\n<div id="site-loader" aria-hidden="false" role="status" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;background:#fff5df;z-index:99999;transition:opacity .35s ease,visibility .35s;">\n  <img src="img/logo_cartoonclub.png" alt="Cartoon Club" style="width:140px;height:auto;margin-bottom:12px;"/>\n  <div style="display:flex;gap:10px;align-items:center;">\n    <span style="width:12px;height:12px;border-radius:50%;background:#c1272d;opacity:.25;display:inline-block;animation:jump 900ms infinite ease-in-out;"></span>\n    <span style="width:12px;height:12px;border-radius:50%;background:#c1272d;opacity:.25;display:inline-block;animation:jump 900ms infinite ease-in-out;animation-delay:120ms;"></span>\n    <span style="width:12px;height:12px;border-radius:50%;background:#c1272d;opacity:.25;display:inline-block;animation:jump 900ms infinite ease-in-out;animation-delay:240ms;"></span>\n  </div>\n  <style>\n    @keyframes jump{0%,80%,100%{transform:translateY(0);opacity:.25}40%{transform:translateY(-10px);opacity:1}}\n    .site-loader-hidden{opacity:0;visibility:hidden;pointer-events:none}\n  </style>\n  <script>\n    (function(){\n      function hide(){var e=document.getElementById(\'site-loader\'); if(!e) return; e.classList.add(\'site-loader-hidden\'); setTimeout(function(){ if(e && e.parentNode) e.parentNode.removeChild(e); },450);}\n      window.hideSiteLoader = hide;\n      window.addEventListener(\'load\', function(){ setTimeout(hide, 150); });\n    })();\n  <\/script>\n</div>\n');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>จัดการช่องทางการชำระเงิน - Cartoon Club</title>

    <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/payment.css">
</head>

<body>
    <div class="page-wrapper">
        <!-- Navbar Component -->
        <div id="navbar"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="payment-wrapper">

                <!-- Back Button Section (Frame 74:760) -->
                <div class="payment-back" id="backButton">
                    <div class="payment-back-icon">
                        <img src="icon/Back Arrow-2.png" alt="Back Left" />
                    </div>
                    <div class="payment-back-text">บัญชีของฉัน</div>
                </div>

                <!-- Payment Content Section (Frame 74:775) -->
                <div class="payment-content">
                    <div class="payment-form-section">

                        <!-- Header Section (Frame 74:773) -->
                        <div class="payment-header">
                            <h1 class="payment-title">จัดการช่องทางการชำระเงิน</h1>
                            <p class="payment-subtitle">เลือกช่องทางชำระเงินที่คุณสะดวก</p>
                        </div>

                        <!-- Visa Card Component (Frame 22:1031) -->
                        <div class="visa-card">
                            <div class="visa-card-content">
                                <div class="visa-card-left">
                                    <i class="fas fa-credit-card visa-card-icon"></i>
                                    <span class="visa-card-number"></span>
                                </div>
                                <button class="visa-card-update-btn" id="updateCardBtn">
                                    อัปเดต
                                </button>
                            </div>
                        </div>

                    </div>

                </div>

            </div>
        </main>

        <!-- Footer Component -->
        <div id="footer"></div>
    </div>

    <!-- JavaScript Components -->
    <!-- Lenis: smooth scroll lib (jsDelivr) -->
    <script src="https://cdn.jsdelivr.net/npm/lenis@1.3.15/dist/lenis.min.js"></script>
    <script type="module" src="js/navbar.js"></script>
    <script src="js/footer.js"></script>

    <!-- Payment Page Interactions -->
    <script type="module">
        import { auth, db, getUserDoc, updateUserDoc } from './firebase-controller.js';
        import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js';

        document.addEventListener('DOMContentLoaded', () => {
            // Back button handler - กลับไปหน้า Profile
            const backButton = document.getElementById('backButton');
            if (backButton) {
                backButton.addEventListener('click', () => {
                    window.location.href = 'profile.html';
                });
            }

            // Update card button handler - ไปหน้า Manage Payment
            const updateCardBtn = document.getElementById('updateCardBtn');
            if (updateCardBtn) {
                updateCardBtn.addEventListener('click', () => {
                    window.location.href = 'manage-payment.html';
                });
            }

            // Show current saved card (if any)
            const visaNumberEl = document.querySelector('.visa-card-number');
            onAuthStateChanged(auth, async (user) => {
                if (!user) {
                    // hide or redirect
                    visaNumberEl.textContent = 'ยังไม่บันทึก';
                    return;
                }
                try {
                    const snap = await getUserDoc(user.uid);
                    const data = snap.exists() ? snap.data() : {};
                    const number = data.card?.number;
                    if (number) visaNumberEl.textContent = number;
                    else visaNumberEl.textContent = 'ยังไม่บันทึก';
                } catch (err) {
                    console.error('Failed to load payment info', err);
                }
            });

            // Submit button handler (persist any local changes) - here we'll allow toggling autoRenew via confirm
            const submitBtn = document.getElementById('submitBtn');
            if (submitBtn) {
                submitBtn.addEventListener('click', async () => {
                    const user = auth.currentUser;
                    if (!user) {
                        showAlertModal('กรุณาเข้าสู่ระบบก่อนดำเนินการ');
                        window.location.href = 'login.html';
                        return;
                    }
                });
            }
        });
    </script>
</body>

</html>